> https://drafts.csswg.org/css2/zindex.html#stacking-defs

# 层叠上下文

## 定义

- tree order

  Preorder depth-first traversal of the *rendering* tree, in logical (not visual) order for bidirectional content, after taking into account properties that move boxes around.

- Element

  In this description, "element" refers to actual elements, pseudo-elements, and anonymous boxes. Pseudo-elements and anonymous boxes are treated as descendants in the appropriate places. For example, an outside list marker comes before an adjoining ':before' box in the line box, which comes before the content of the box, and so forth.

## 绘制顺序

栈底距离用户最远, 栈顶离用户最近:

![image-20200531011328782](./assets\image-20200531011328782.png)

层叠上下文的背景和拥有最小值的层叠上下文是栈底, 而值最大的层叠上下文在栈顶.

被包裹在另外一个画布中的画布是透明的, 反之它具有用户代理所定义的颜色. 它可以无限扩展且包含根元素. 最初, 视口的左上角固定在画布原点.

# 分层简介

## 详解层叠等级: `z-index` 属性

The order in which the rendering tree is painted onto the canvas is  described in terms of stacking contexts. Stacking contexts can  contain further stacking contexts. A stacking context is atomic from  the point of view of its parent stacking context; boxes in other  stacking contexts may not come between any of its boxes.

Each box belongs to one stacking context. Each positioned box in a given stacking context has an integer stack level, which is its position on the z-axis relative other stack levels within the same stacking context. Boxes with greater stack levels are always formatted in front of boxes with lower stack levels.  Boxes may have negative stack levels.  Boxes with the same stack level in a stacking context are stacked back-to-front according to document tree order.

The root element forms the root stacking context. Other stacking  contexts are generated by any positioned element (including  relatively positioned elements) having a computed value of 'z-index'  other than 'auto'. Stacking contexts are not necessarily related to  containing blocks. In future levels of CSS, other properties may  introduce stacking contexts, for example '[opacity](http://www.w3.org/TR/css3-color/#transparency)' [[CSS3COLOR\]](https://www.w3.org/TR/CSS22/refs.html#ref-CSS3COLOR).

# z-index 规范

对于一个已经定位的元素, `z-index` 值指定:

1. 盒子在当前层叠上下文的层叠级别
2. 盒子是否建立了层叠环境

其值具有下列含义:

- integer
  - 该整数是当前堆栈上下文中生成的框的堆栈级别。该框还建立了一个新的堆栈上下文。
- auto
  - 当前堆栈上下文中生成的框的堆栈级别为0。如果框具有“ position：fixed”或如果它是根元素，它还将建立一个新的堆栈上下文。