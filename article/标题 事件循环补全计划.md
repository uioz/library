# Ê†áÈ¢ò: ‰∫ã‰ª∂Âæ™ÁéØË°•ÂÖ®ËÆ°Âàí

# ÂâçË®Ä

‰∫ã‰ª∂Âæ™ÁéØ(event loop)ÊòØ‰∏Ä‰∏™Âú® JavaScript Â∏∏Ë¢´ÊèêËµ∑ÁöÑÊ¶ÇÂøµ, ÂÆÉÂ≠òÂú®‰∫éÊµèËßàÂô®‰πüÂ≠òÂú®‰∫é Node.js ‰∏≠, Âõ†‰∏∫ÂÆÉÂ§çÊùÇÁöÑËøêË°åÊú∫Âà∂ÂíåÂèòÂπªËé´ÊµãÁöÑË°å‰∏∫‰ª§‰∫∫Èöæ‰ª•Áê¢Á£®, Êõ¥ÊòØÊàê‰∏∫Èù¢ËØïÊó∂ÂÄôÁöÑÂøÖËÄÉÈ¢òÁõÆ.

Âú®Êú¨ÁØáÊñáÁ´†‰∏≠Â∞Ü‰ºöÊÄªÁªì "‰∫ã‰ª∂Âæ™ÁéØ" Ëøô‰∏™Ê¶ÇÂøµ, Êó†ËÆ∫ÊòØÊµèËßàÂô®Á´ØËøòÊòØ Node.js Á´ØÈÉΩ‰ºöÊ∂âÂèä.

‰∏∫‰∫ÜÂ∞ΩÂèØËÉΩÁöÑÂáèÂ∞ëÈîôËØØ, Êú¨ÁØáÊñáÁ´†ÁöÑ‰ø°ÊÅØÊù•Ê∫êÂü∫‰∫é "ÂÆòÊñπÊñáÊ°£" ‰ª•Âèä "ËßÑËåÉ" Âíå ÂéÜÂ±ä jsconf Â§ß‰ºö‰∏äÁöÑÊúâÂÖ≥ "‰∫ã‰ª∂Âæ™ÁéØ" ÁöÑÊºîËÆ≤, Êú¨ÁØáÊñáÁ´†ÂÆûÈôÖ‰∏äÂ∞±ÊòØÊääËøô‰∫õÂÜÖÂÆπÊÄªÁªìÂà∞‰∫Ü‰∏ÄËµ∑ÁöÑÁªìÊûú, ‰Ω†ÂèØ‰ª•Âú®ÊñáÁ´†ÁöÑÊú´Â∞æËé∑ÂèñËøô‰∫õÂÜÖÂÆπÊ∫êÂú∞ÂùÄ.



# ÂàùÊé¢‰∫ã‰ª∂Âæ™ÁéØ

> https://youtu.be/8aGhZQkoFbQ



Êàë‰ª¨ÂÖà‰ªéÊµèËßàÂô®ÂºÄÂßã, Âõ†‰∏∫Â§ßÈÉ®ÂàÜ‰ªé‰∫ã Node.js ÂºÄÂèëÁöÑÂ§ßÂ§öÊï∞‰∫∫ÊàñÂ§öÊàñÂ∞ëÈÉΩ‰∫ÜËß£ÊµèËßàÂô®‰∏≠ÁöÑ‰∫ã‰ª∂Âæ™ÁéØÁöÑÂü∫Êú¨Ê¶ÇÂøµ.

## JavaScriptËøêË°åÁöÑÂü∫Êú¨ÊµÅÁ®ã

Êàë‰ª¨ÈÉΩÁü•ÈÅìJavaScriptÊòØ‰∏Ä‰∏™ÂçïÁ∫øÁ®ãÁöÑÁºñÁ®ãËØ≠Ë®Ä, ËøôÊÑèÂë≥ÁùÄÂÆÉÂè™ËÉΩÊúâ‰∏Ä‰∏™Ë∞ÉÁî®Ê†à, ÊâßË°åËøáÁ®ã‰∏≠ÊØèÊ¨°Âè™ËÉΩÂÅö‰∏Ä‰ª∂‰∫ãÊÉÖ.

‰∏∫‰∫ÜÂÖÖÂàÜÁêÜËß£, Êàë‰ª¨Êù•‰æã‰∏æ‰∏Ä‰∏™ÁÆÄÂçïÁöÑ‰æãÂ≠ê:

```javascript
function fun1() {
  return 'fun1'
}

function fun2() {
  return 'fun2' + fun1();
}

function fun3() {
  console.log(fun2());
}

fun3();
```

‰∏ÄÊó¶‰ª£Á†ÅÊâßË°åË∞ÉÁî®Ê†à‰∏≠ÂáΩÊï∞ÂéãÂÖ•ÁöÑÈ°∫Â∫èÂ¶Ç‰∏ã:

```
+----------+ +----------+ +----------+
|    stack | |    stack | |    stack |
|          | |          | |          |
|          | |          | |          |
|          | |          | | +------+ |
|          | |          | | | fun3 | |
|          | |          | | +------+ |
|          | |          | |          |
|          | | +------+ | | +------+ |
|          | | | fun2 | | | | fun2 | |
|          | | +------+ | | +------+ |
|          | |          | |          |
| +------+ | | +------+ | | +------+ |
| | fun1 | | | | fun1 | | | | fun1 | |
| +------+ | | +------+ | | +------+ |
|          | |          | |          |
+----------+ +----------+ +----------+
```

‰Ωç‰∫éÊ†àÈ°∂ÁöÑÂáΩÊï∞(fun3)ÊâßË°åÂÆåÊàêÂêéË∞ÉÁî®Ê†à‰ºöÊää‰ªñÂºπÂá∫:

```
+----------+ +----------+ +----------+
|    stack | |    stack | |    stack |
|          | |          | |          |
|          | |          | |          |
|          | |          | |          |
|   üí•     | |          | |          |
|          | |          | |          |
|          | |          | |          |
| +------+ | |          | |          |
| | fun2 | | |    üí•    | |          |
| +------+ | |          | |          |
|          | |          | |          |
| +------+ | | +------+ | |          |
| | fun1 | | | | fun1 | | |    ‚ú®    |
| +------+ | | +------+ | |          |
|          | |          | |          |
+----------+ +----------+ +----------+
```

Ë∞ÉÁî®Ê†àË¢´JavaScriptÂºïÊìé‰ΩøÁî®ÂíåÁõëËßÜ, ÊâÄ‰ª•ÂΩìÊàë‰ª¨Âú®ÂáΩÊï∞‰∏≠ÊäõÂá∫‰∫Ü‰∏Ä‰∏™ÈîôËØØ‰ΩÜÊòØÊ≤°ÊúâÂØπÂ∫îÁöÑ `try/catch` ËØ≠Âè•ÁöÑÊó∂ÂÄô:

```javascript
function fun1() {
  throw new Error('Warning: Nuclear Missile Launched') // ÊäõÂá∫‰∏Ä‰∏™ÈîôËØØ‰ΩÜÊòØÊ≤°ÊúâÂØπ‰∫éÁöÑ try/catch ËØ≠Âè•
}

function fun2() {
  return 'fun2' + fun1();
}

function fun3() {
  console.log(fun2());
}

fun3();
```

ÂèØ‰ª•Âú®ÊéßÂà∂Âè∞‰∏≠ÁöÑÊä•Èîô‰∏≠ÁúãÂà∞Ë∞ÉÁî®Ê†àÁöÑ‰ø°ÊÅØ:

![1566047594418](C:\Users\zhao\Documents\library\article\assets\1566047594418.png)

‰ΩÜÊòØË∞ÉÁî®Ê†à‰πüÊòØËÑÜÂº±ÁöÑÂ¶ÇÊûúÊàë‰ª¨ÂàõÂª∫‰∏Ä‰∏™Êó†Ê≥ï‰∏≠Êñ≠Ë∞ÉÁî®ÂáΩÊï∞, ÈÇ£‰πàË∞ÉÁî®Ê†à‰ºöÁû¨Èó¥ÁàÜÁÇ∏üí•ËøôÁßçË°å‰∏∫Ë¢´Áß∞‰∏∫ "Ê†àÊ∫¢Âá∫". ÂèØÂñúÂèØË¥∫ÁöÑÊòØJavaScript‰ºöÁõëËßÜË∞ÉÁî®Ê†à, ‰∏ÄÊó¶Ë∞ÉÁî®Ê†àÂá∫Áé∞ "Ê†àÊ∫¢Âá∫" JavaScript ‰ºöÁªàÊ≠¢‰ª£Á†ÅÁöÑÊâßË°åÂπ∂‰∏îÊäõÂá∫ÈîôËØØ:

```javascript
function foobar() {
	foobar();
}

foobar();
```

ÊäõÂá∫ "Ê†àÊ∫¢Âá∫" ÈîôËØØ:

![1566048013705](C:\Users\zhao\Documents\library\article\assets\1566048013705.png)

## ÈòªÂ°ûÁöÑÂùèÂ§Ñ

Âú® Web ÂºÄÂèë‰∏≠Êàë‰ª¨ÁªèÂ∏∏Ë¶Å‰ºöÂê¨Âà∞Ë¶ÅÈÅøÂÖçÊµèËßàÂô®ÈòªÂ°û, "ÈòªÂ°û" Âê¨Ëµ∑Êù•ÊúâÁÇπÂÉèÊàë‰ª¨Â∏∏ËØ¥ÁöÑ "ÁîµËÑëÂç°‰Ωè‰∫Ü" ‰∏≠ÁöÑ "Âç°‰Ωè".

ÂÆûÈôÖ‰∏äÈòªÂ°ûÂπ∂Ê≤°Êúâ‰∏Ä‰∏™‰∏•Ê†ºÁöÑÂÆö‰πâ, JavaScript ÁöÑËøêË°åÈÄüÂ∫¶ÊòØÂæàÂø´ÁöÑ, ÊâßË°åÂá†‰∏™ÁÆÄÂçïÁöÑ "console.log" ‰Ω†Êó†Ê≥ï‰Ωì‰ºöÂà∞ËøôÂÖ∂‰∏≠ÊâÄËä±Ë¥πÁöÑÊó∂Èó¥, Â¶ÇÊûúË∞ÉÁî®Ê†à‰∏≠Ê≠£Âú®ÊâßË°åÁöÑÂáΩÊï∞Ëä±Ë¥π‰∫ÜÂ§ßÈáèÁöÑÊó∂Èó¥, Êàë‰ª¨ÊÑüËßâÊµèËßàÂô®Ë¢´Âç°‰Ωè‰∫Ü, ‰ΩìÈ™å‰∏çÊµÅÁïÖÊ≠§Êó∂Êàë‰ª¨ËØ¥, ÊµèËßàÂô®Ë¢´ÈòªÂ°û‰∫Ü.

‰ΩÜÊòØÊµèËßàÂô®‰∏ç‰ªÖ‰ªÖÊâßË°å JavaScript ‰ª£Á†ÅËøò‰ºöÂºÇÊ≠•ÁöÑÂä†ËΩΩÂ§ñÈÉ®ËµÑÊ∫êÊñá‰ª∂, Ëøô‰∫õÂä†ËΩΩÁöÑÊµÅÁ®ã‰πüÂèØ‰ª•Ë¢´ JavaScript ÊâÄÊéßÂà∂, ‰æãÂ¶ÇÊàë‰ª¨ÈÄöËøá JavaScript ÂèëËµ∑‰∏Ä‰∏™ÂêåÊ≠•ÁöÑÁΩëÁªúËØ∑Ê±Ç:

```javascript
var oReq = new XMLHttpRequest();
oReq.onload = function(){};
oReq.open("get", "https://xxx.com/", false); // false Ë°®Á§∫ÂêåÊ≠•ÂèëÈÄÅËØ∑Ê±Ç(ËøôÁßçÊñπÂºèÂ∑≤Áªè‰∏çÂú®Ë¢´Êé®Ëçê‰ΩøÁî®‰ªÖ‰ªÖÁî®‰∫éÁ§∫‰æã)
oReq.send();
alert('running!'); // Âè™ÊúâËØ∑Ê±ÇÂÆåÊàêÂêé alert Êâç‰ºöÊâßË°å
```

Ëøô‰∏™ËØ∑Ê±ÇÊúâÂèØËÉΩÈúÄË¶Å 20ms ÊàñËÄÖ 300ms ÁîöËá≥Êõ¥Èïø, Âú®ËØ∑Ê±ÇÁöÑËøáÁ®ã‰∏≠ÊµèËßàÂô®‰ºö‰∏ÄÁõ¥Á≠âÂæÖËØ∑Ê±ÇÂÆåÊàêÁîöËá≥‰ºöÂÅúÊ≠¢È°µÈù¢ÁöÑÊ∏≤Êüì, Êàë‰ª¨ÂèØ‰ª•ÊòéÊòæÁöÑÊÑüÂèóÂà∞ÊµèËßàÂô®Âç°‰Ωè‰∫Ü, ËøôÊòØÂÖ∏ÂûãÁöÑÈòªÂ°û.

## ÂºÇÊ≠•ÂõûË∞É

ÊµèËßàÂô®Â∞ÜÊâÄÊúâÂèØËÉΩËä±Ë¥πÂ§ßÈáèÊó∂Èó¥Á≠âÂæÖÁöÑÊìç‰ΩúÈÉΩÊèê‰æõ‰∫ÜÂØπÂ∫îÁöÑÂºÇÊ≠•Êé•Âè£, ËøôÁßçËß£ÂÜ≥ÊñπÂºèË¢´Áß∞‰∏∫ "ÂºÇÊ≠•ÂáΩÊï∞" ÊàñËÄÖ "ÂõûË∞ÉÂáΩÊï∞" ÊàñËÄÖ "ÂºÇÊ≠•ÂõûË∞É" Á≠â.

‰∏Ä‰∏™ÂÖ∏ÂûãÁöÑ‰æãÂ≠êÂ¶Ç‰∏ã:

```javascript
console.log('hello');

setTimeout(function foobar(){
    console.log('delay');
},1000);

console.log('world');
```

Êàë‰ª¨ÈÉΩÁü•ÈÅìËøôÊÆµ‰ª£Á†Å‰ºöËæìÂá∫ÁöÑÈ°∫Â∫èÊòØ:

1. hello
2. world
3. delay

ÈÇ£‰πàÊµèËßàÂô®Âà∞Â∫ïÊòØÂ¶Ç‰ΩïËß£ÈáäËøôÊÆµ‰ª£Á†ÅÁöÑÂë¢, Êàë‰ª¨ÂèØ‰ª•ËßÇÂØüÊµèËßàÂô®ÁöÑË∞ÉÁî®Ê†à:

```
console.log('hello'); // ÂéãÂÖ•Ê†à‰∏≠ÊâßË°å
console.log('hello'); // ÊâßË°åÂÆåÊàêÊ†àÂºπÂá∫

setTimeout            // ÂéãÂÖ•Ê†à‰∏≠ÊâßË°å
setTimeout            // ÊâßË°åÂÆåÊàêÊ†àÂºπÂá∫

console.log('world'); // ÂéãÂÖ•Ê†à‰∏≠ÊâßË°å
console.log('world'); // ÊâßË°åÂÆåÊàêÊ†àÂºπÂá∫

-------1000msËøáÂêé------

foobar                // ÂéãÂÖ•Ê†à‰∏≠ÊâßË°å
console.log('delay'); // ÂéãÂÖ•Ê†à‰∏≠ÊâßË°å
console.log('delay'); // ÊâßË°åÂÆåÊàêÂºπÂá∫
foobar                // ÊâßË°åÂÆåÊàêÂºπÂá∫

```

ÊúÄÁ•ûÂ•áÁöÑ‰∫ãÊÉÖÂá∫Áé∞‰∫Ü `setTimeout` ÊâßË°åÂÆåÊàêÂêéÂ∞±Ë¢´Ë∞ÉÁî®Ê†àÂºπÂá∫‰∫Ü, ‰ΩÜÊòØ‰∏çÁü•‰ΩïÊïÖ 1000ms Âêé `setTimeout` ‰∏≠ÁöÑ `foobar` Ë¢´Á•ûÂ•áÁöÑÂî§ÈÜí‰∫Ü, ËøôÊòØÊÄé‰πàÂõû‰∫ã?

## È¢òÂ§ñËØù webapi

Âú® JavaScript ‰∏≠ÊâßË°åÂÖÉÁ¥†ÁªëÂÆö‰∫ã‰ª∂, ‰ΩøÁî® `setTimeout` ËÆæÁΩÆ‰∏Ä‰∏™Âª∂Êó∂ÊâßË°å, ÊàñËÄÖÂèëËµ∑‰∏ÄÊ¨°ÁΩëÁªúËØ∑Ê±Ç. Ëøô‰∫õÈÉΩÊòØwebÂºÄÂèëËÄÖÁöÑÂÆ∂Â∏∏‰æøÈ•≠, ÂØπ‰∫éÊàë‰ª¨Êù•ËØ¥Ëøô‰∫õÂÜÖÂÆπÂ∞±ÊòØ JavaScript ÁöÑ‰∏ÄÈÉ®ÂàÜ‰∫Ü, ‰ΩÜÊòØÂÆûÈôÖ‰∏äËøô‰∫õÂÜÖÂÆπÂπ∂Ê≤°ÊúâÂú® ECMAScript Âà∂ÂÆöÁöÑÊ†áÂáÜ‰∏≠, ÂåÖÊã¨Êàë‰ª¨ËÆ®ËÆ∫ÁöÑ "‰∫ã‰ª∂Âæ™ÁéØ" Êú∫Âà∂ÂÆÉ‰πüÊ≤°ÊúâÂ≠òÂú®‰∫éËßÑËåÉ‰∏≠‰πüÂ∞±ÊòØËØ¥Ëøô‰∏™Êú∫Âà∂ÊòØÁã¨Á´ã‰∫é JavaScript ÂºïÊìéÁöÑÂäüËÉΩ.

Ëøô‰∫õAPIË¢´Áß∞‰∏∫ `webapi` ÂÆÉ‰ª¨ÊúâËá™Â∑±ÁöÑËßÑËåÉÂíåÂÆûÁé∞‰∏é JavaScript ËøôÈó®ËØ≠Ë®ÄÊ≤°ÊúâÂÖ≥Á≥ª, Âú®Ëøô‰ªΩÊù•Ëá™‰∫éMDNÁöÑ[È°µÈù¢‰∏ä](https://developer.mozilla.org/zh-CN/docs/Web/API)Âàó‰∏æ‰∫ÜÊâÄÊúâÁöÑAPI.

## Âü∫Êú¨‰∫ã‰ª∂Âæ™ÁéØ

Êàë‰ª¨‰πãÂâçÊèêÂà∞‰∫Ü JavaScript Áî±‰∫éÂÖ∂ÂçïÁ∫øÁ®ãÁöÑÁâπÊÄßÂè™ËÉΩÂú®Âêå‰∏ÄÊó∂Èó¥ÊâßË°åÂêå‰∏ÄÈó¥‰∫ãÊÉÖ, ËøôÊòØÊ≠£Á°ÆÁöÑ, ‰ΩÜÊòØÊµèËßàÂô®‰∏ç‰ªÖ‰ªÖÊã•ÊúâËß£Èáä JavaScript ËÑöÊú¨ÁöÑÂºïÊìé, ËøòÊúâ‰∏ÄÂ†ÜÂÖ∂‰ªñÁöÑÁ®ãÂ∫èÊù•Â§ÑÁêÜËØ∏Â¶Ç `DOM` `XmlHttpRequest` `setTimeout` Ëøô‰∫õ‰ªªÂä°.

Ëøô‰∫õÁ®ãÂ∫èÂêÑÂè∏ÂÖ∂ËÅåÂÆåÊàêËá™Â∑±Ë¥üË¥£ÁöÑÈÉ®ÂàÜ, ÂÆÉ‰ª¨ÊòØÁã¨Á´ã‰∫é JavaScript ÂºïÊìé‰πãÂ§ñÁöÑÂÜÖÂÆπ, Ëøô‰∫õÁ®ãÂ∫èÂèØËÉΩËøêË°åÂú®Áã¨Á´ãÁ∫øÁ®ã‰∏äÊàñËÄÖËøõÁ®ã‰∏äÂÆÉ‰ª¨ÈÄöËøá`webapi` Êù•Âíå JavaScriptÂºïÊìéËøõË°åÈÄö‰ø°, ÊâÄ‰ª•Êàë‰ª¨ÈúÄË¶ÅÈÄöËøá "ÂõûË∞É" ÁöÑÊñπÂºèËøõË°åÂºÇÊ≠•ÁºñÁ®ã.

ËÄå **‰∫ã‰ª∂Âæ™ÁéØ** Áî®‰∫éÁÆ°ÁêÜËøô‰∫õÂºÇÊ≠•‰ªªÂä°Âú®ÂêàÈÄÇÁöÑÊó∂Êú∫ÊâßË°å.

`setTimeout` ‰Ωú‰∏∫ `webapi` ÂÖ∏ÂûãÁöÑ‰æãÂ≠ê, Êàë‰ª¨Êù•ËßÇÂØü‰∏Ä‰∏ãÂÆÉÊòØÂ¶Ç‰ΩïËøêË°åÁöÑ, È¶ñÂÖà `setTimeout` ‰∏ÄÊó¶Ë¢´ÊâßË°å‰æøÂ∞ÜÂáΩÊï∞Èí©Â≠êÁßª‰∫§ÁªôÂØπÂ∫îÁöÑ `webapi` Âπ∂‰∏îÂºÄÂßãËÆ°Êó∂:

```
+--------------------------------+     +---------------------+
|                                |     |webapis              |
|                                |     | +----------------+  |
| setTimeout(function foobar() { |     | |                |  |
| 	console.log('delay')         | +-> | | timer-0 -- cb()|  |
| },0);                          |     | |                |  |
|                                |     | +----------------+  |
|                                |     |                     |
+--------------------------------+     +---------------------+
```

Áî±‰∫éÊàë‰ª¨ÁöÑÂÄíËÆ°Êó∂ÊòØ0, ÊâÄ‰ª•ËÆ°Êó∂‰ºöÁ´ãÂç≥ÂÆåÊàê, `webapi` Â∞ÜÂáΩÊï∞Èí©Â≠êÁßª‰∫§Áªô **‰ªªÂä°ÈòüÂàó** .

```
+--------------------------------+     +----------+
|                                |     |webapis   |
|                                |     |          |
| setTimeout(function foobar() { |     |          |
| 	console.log('delay')         |     |          | +-+
| },0);                          |     |          |   |
|                                |     |          |   |
|                                |     |          |   |
+--------------------------------+     +----------+   |
                                                      |
+-------------------------------------------------+   |
|                               task queue        |   |
| +--------------+                                |   |
| |              |                                |   |
| |    cb()      |                                | <-+
| |              |                                |
| +--------------+                                |
|                                                 |
+-------------------------------------------------+

```

Êé•‰∏ãÊù•Áªà‰∫éËΩÆÂà∞ **‰∫ã‰ª∂Âæ™ÁéØ** ‰∏äÂú∫‰∫Ü, ‰∫ã‰ª∂Âæ™ÁéØÂÆåÊàê‰∏Ä‰ª∂ÈùûÂ∏∏ÁÆÄÂçïÁöÑÂ∑•‰Ωú, ÂÆÉÂà§Êñ≠Â¶ÇÊûú:

1. Ë∞ÉÁî®Ê†àÊòØÁ©∫ÁöÑ
2. ‰ªªÂä°ÈòüÂàó‰∏≠Â≠òÂú®ÁùÄ‰ªªÂä°

ÈÇ£‰πàÂ∞±Â∞ÜËøô‰∏™‰ªªÂä°ÁßªÂÖ•Âà∞Ë∞ÉÁî®Ê†à‰∏≠ÊâßË°å:

```
+--------------------------------+ +------------------+
|                                | |           stack  |
|                                | | +--------------+ |
| setTimeout(function foobar() { | | |              | |
| 	console.log('delay')         | | |  cb - foobar | |
| },0);                          | | |              | |
|                                | | +--------+-----+ |
|                                | |          ^       |
+--------------------------------+ |          |       |
event loop ‚è≥                      |          |       |
+----+---------------------------+ |          |       |
|    |                           | |          |       |
|    |                           | |          |       |
|    +-- task ------> push -------------------+       |
|                                | |                  |
+--------------------------------+ +------------------+

```

ÁÑ∂ÂêéÂæÄÂ§çÂæ™ÁéØËøô‰∏™ËøáÁ®ã, ËøôÂ∞±ÊòØ‰∫ã‰ª∂Âæ™ÁéØÁöÑÂü∫Êú¨ÊµÅÁ®ã.

Áé∞Âú®Êàë‰ª¨Êù•ÊèêÂá∫‰∏Ä‰∏™ `ajax` ÁöÑ‰æãÂ≠ê, Â∞ùËØï‰∏Ä‰∏ã‰Ω†ËÉΩËØ¥Âá∫‰ªñÁöÑÊâßË°åÊµÅÁ®ãÂêó:

```javascript
console.log('hello');

$.get('https:www.google.com',function foobar(){ console.log('callback') });

console.log('world');
```

‰ªñÁöÑÊâßË°åÊµÅÁ®ãÂ¶Ç‰∏ã:

1. console.log('hello') --> ÂéãÂÖ•Ë∞ÉÁî®Ê†à‰∏≠ÊâßË°å
2. console.log('hello') --> ÊâßË°åÂÆåÊàêÂºπÂá∫Ë∞ÉÁî®Ê†à
3. $.get --> ÂéãÂÖ•Ê†à‰∏≠ÊâßË°å
4. $.get --> Ë∞ÉÁî®‰∫Ü `webapi` ‰∏≠ÁöÑ `XHR` ÂèëËµ∑‰∫ÜÁΩëÁªúËØ∑Ê±Ç, Âπ∂‰øùÂ≠òÂÖ∂ÂáΩÊï∞Èí©Â≠ê
5. $.get --> ÊâßË°åÂÆåÊàêÂºπÂá∫Ë∞ÉÁî®Ê†à
6. console.log('world') --> ÂéãÂÖ•Ë∞ÉÁî®Ê†à‰∏≠ÊâßË°å
7. console.log('world') --> ÊâßË°åÂÆåÊàêÂºπÂá∫Ë∞ÉÁî®Ê†à
8. ÁΩëÁªúËØ∑Ê±ÇÂÆåÊàê `webapi` Â∞ÜÂáΩÊï∞Èí©Â≠êÁßªÂä®Âà∞‰ªªÂä°ÈòüÂàó‰∏≠
9. ‰∫ã‰ª∂Âæ™ÁéØ--> Ê£ÄÊü•Ë∞ÉÁî®Ê†àÊòØÂê¶‰∏∫Á©∫ Ê£ÄÊü•‰ªªÂä°ÈòüÂàó‰∏≠ÊòØÂê¶Êúâ‰ªªÂä° (‰∫ã‰ª∂Âæ™ÁéØ‰∏ÄÁõ¥Â≠òÂú®Âπ∂ÈùûÂú®Âè™Âú®Ê≠§ÂàªËøõË°åÊ£ÄÊü•)
   1. Ë∞ÉÁî®Ê†à‰∏∫Á©∫
   2. Ê£ÄÊü•Âà∞ËØ∑Ê±Ç‰ªªÂä°
   3. Â∞ÜËØ•‰ªªÂä°(foobarÂáΩÊï∞)ÂéãÂÖ•Âà∞Ë∞ÉÁî®Ê†à‰∏≠
10. console.log('callback') --> ÂéãÂÖ•Ë∞ÉÁî®Ê†à‰∏≠ÊâßË°å
11. console.log('callback') --> ÊâßË°åÂÆåÊàêÂºπÂá∫Ë∞ÉÁî®Ê†à
12. foobar --> ÊâßË°åÂÆåÊàêÂºπÂá∫Ë∞ÉÁî®Ê†à
13. Ë∞ÉÁî®Ê†àÂÜçÊ¨°Ê∏ÖÁ©∫

# ‰∫ã‰ª∂Âæ™ÁéØÂ¶Ç‰ΩïÂΩ±ÂìçÊ∏≤Êüì

> https://youtu.be/cCOL7MC4Pl0

Âú®‰∏ä‰∏ÄËäÇ‰∏≠Êàë‰ª¨ÊèêÂà∞‰∫Ü JavaScript ÊòØÂçïÁ∫øÁ®ãÁöÑÂ¶ÇÊûúËä±Ë¥πÂ§ßÈáèÁöÑÊó∂Èó¥ËøêË°å JavaScript ÈÇ£‰πàÂ∞±‰ºöÈòªÂ°ûÊµèËßàÂô®, ÂØºËá¥ÊµèËßàÂô®Êó†Ê≥ïÂÆåÊàêÂÖ∂‰ªñÂ∑•‰Ωú, Âπ∂‰∏îÂàùÊ¨°‰∫ÜËß£‰∫Ü "‰∫ã‰ª∂Âæ™ÁéØ" ÊòØÂ¶Ç‰ΩïËß£ÂÜ≥ÈóÆÈ¢òÁöÑ. Âú®Ëøô‰∏ÄËäÇ‰∏≠Êàë‰ª¨‰ºöÊõ¥Âä†Ê∑±ÂÖ•, Êé¢ËÆ® "‰∫ã‰ª∂Âæ™ÁéØ" ÊòØÂ¶Ç‰ΩïÂΩ±ÂìçÊ∏≤Êüì.

ÂÆûÈôÖ‰∏ä‰∫ã‰ª∂Âæ™ÁéØÁöÑ‰ΩúÁî®ËåÉÂõ¥ÂèØËÉΩË∂Ö‰πé‰Ω†ÁöÑÊÉ≥Ë±°, ‰∏æ‰∏™‰æãÂ≠êÊâÄÊúâÁöÑDOM‰∫ã‰ª∂ÂÆûÈôÖ‰∏äÈÉΩÊòØÂèóÂà∞‰∫Ü "‰∫ã‰ª∂Âæ™ÁéØ" ÊéßÂà∂ÁöÑ, Èô§Ê≠§‰ª•Â§ñËøòÂåÖÊã¨ÂåÖÊã¨ÁΩëÁªúËØ∑Ê±Ç, IOÊìç‰ΩúÁ≠âÁ≠âËøô‰∫õÂ∏∏ËßÅÁöÑÂäüËÉΩ. Âõ†‰∏∫Âú®ËÉåÂêéËøô‰∫õ‰∫ã‰ª∂ÁöÑËß¶ÂèëËÄÖÂÆûÈôÖ‰∏äÈÉΩÊòØÂ∞Ü‰∏é‰∫ã‰ª∂ÊúâÂÖ≥ÁöÑ‰ø°ÊÅØÊîæÂÖ•Âà∞‰∫Ü "‰ªªÂä°ÈòüÂàó" ‰∏≠ÁúüÊ≠£ËÆ©Ëøô‰∫õÂÜÖÂÆπË¢´ÊâßË°åÁöÑÂÆûÈôÖ‰∏äÊòØ "‰∫ã‰ª∂Âæ™ÁéØ", ËøòËÆ∞Âæó "‰∫ã‰ª∂Âæ™ÁéØ" ÊòØÂ¶Ç‰ΩïÂ∑•‰ΩúÁöÑÂêó? ÈÄöËøá‰ª•‰∏ãÁöÑ‰∏§‰∏™Âà§Êñ≠, "‰∫ã‰ª∂Âæ™ÁéØ" ‰ºöÂ∞ÜÊúÄËøëÁöÑ‰ªªÂä°ÁßªÈÄÅÂà∞ "Ë∞ÉÁî®Ê†à" ‰∏≠:

1. ‰ªªÂä°ÈòüÂàó‰∏≠Âê´Êúâ‰ªªÂä°
2. Ë∞ÉÁî®Ê†à‰∏∫Á©∫

‰ΩÜÊòØÊµèËßàÂô®‰∏≠‰∏ç‰ªÖ‰ªÖÊâßË°å JavaScript ‰ª£Á†ÅËøò‰ºöÂ§ÑÁêÜÈ°µÈù¢Ê∏≤Êüì, Êàë‰ª¨Áü•ÈÅìÂ¶ÇÊûúËøõË°åÂ§ßÈáèÁöÑ JavaScript ËÆ°ÁÆóÈÇ£‰πàÊµèËßàÂô®‰ºöÂÅúÊ≠¢Ê∏≤ÊüìËøôÈáåÈù¢Âà∞Â∫ïÈöêËóèÁùÄ‰ΩïÁßçÁöÑÂü∫ÊÉÖÂÖ≥Á≥ª? Êàë‰ª¨ÂÖàÊù•‰∫ÜËß£‰∏Ä‰∏ãÂü∫Êú¨ÁöÑÊ∏≤ÊüìÊ¶ÇÂøµ.

## Âü∫Êú¨ÁöÑÊ∏≤Êüì

Êàë‰ª¨Âú®È°µÈù¢‰∏≠Âä®ÊÄÅÁöÑ‰øÆÊîπÊ†∑ÂºèÁïåÈù¢‰ºöËøõË°åÂÆûÊó∂ÂèçÂ∫î, ÊâÄ‰ª•Êàë‰ª¨ËÆ§‰∏∫Ëøô‰∫õÊìç‰ΩúÊòØÂêåÊ≠•ÁöÑÊìç‰Ωú, ‰ΩÜÊòØÂÆûÈôÖ‰∏äÊµèËßàÂô®Âú®ËÉåÂêéËøõË°å‰∫Ü‰ºòÂåñ, ÈáçÂ§çÂ§öÊ≠§ÁöÑÊ†∑ÂºèÊìç‰Ωú‰ºöË¢´ËøõË°åÂêàÂπ∂ÁÑ∂ÂêéÁî±ÊµèËßàÂô®ÂÜ≥ÂÆö‰∏Ä‰∏™ÂêàÈÄÇÁöÑÊó∂Êú∫ÁÑ∂ÂêéÁªü‰∏ÄÊõ¥Êñ∞: 

```javascript
element.style.transition = "transform 1s";
element.style.transform = "translateX(100px)";
element.style.transform = "translateX(500px)";
```

Â∫îÁî®‰∫ÜÊ†∑ÂºèÁöÑÂÖÉÁ¥†Âπ∂‰∏ç‰ºöÊ®™ÂêëÂú® 100px Âíå 500px ‰πãÈó¥Êù•ÂõûÁßªÂä®ËÄåÊòØÁõ¥Êé•ÁßªÂä®Âà∞‰∫Ü 500px, ÊµèËßàÂô®ÊäõÂºÉ‰∫ÜÊóßÁöÑÊó†Áî®ÁöÑÊ†∑Âºè‰øÆÊîπ.

ÊâÄ‰ª•ËØ¥‰øÆÊîπÊ†∑ÂºèÂπ∂‰∏çÊòØÂêåÊ≠•ÁöÑ, ÊµèËßàÂô®ÁöÑ‰ºòÂåñÂ∏¶Êù•ÁöÑÂºÇÊ≠•ÁöÑÊõ¥Êñ∞Êú∫Âà∂ÂØºËá¥ÂÆÉÂíå "‰∫ã‰ª∂Âæ™ÁéØ" ‰πãÈó¥‰∫ßÁîüÂÖ≥ËÅî, Âú®‰∫ÜËß£Ëøô‰∫õÂÖ≥ËÅîÂâçÊàë‰ª¨ÂÖàÊù•‰∫ÜËß£‰∏Ä‰∏ãÊµèËßàÂô®ÁöÑÂü∫Êú¨Ê∏≤ÊüìÊú∫Âà∂.

ÂÖÉÁ¥†Ê†∑ÂºèÂÜ≥ÂÆöÊ∏≤ÊüìÁöÑÁªìÊûú, ‰ªé‰∏ÄÂ†Ü‰ª£Á†ÅËΩ¨‰∏∫ÂèØËßÜÂåñÁöÑÁïåÈù¢ÁªèÂéÜ‰∫ÜËÆ∏Â§öÁéØËäÇ, ËøôÈáåÊàë‰ª¨Êù•ÁÆÄÂçïÁöÑ‰∫ÜËß£‰∏Ä‰∏ãÂÖ∂‰∏≠ÁöÑÂá†‰∏™ÂÖ≥ÈîÆÊ≠•È™§:

1. ËÆ°ÁÆóÊ†∑Âºè - Êî∂ÈõÜ css ËÆ°ÁÆóÂ∫îÁî®Âà∞ÊØè‰∏™ÂÖÉÁ¥†‰∏äÁöÑÊ†∑Âºè
2. Â∏ÉÂ±Ä - Á°ÆÂÆöÈ°µÈù¢‰∏äÁöÑÂÖÉÁ¥†ÁöÑ‰ΩçÁΩÆÂ±ÇÂè†ÂÖ≥Á≥ª
3. ÁªòÂà∂ - ÂàõÂª∫ÂÆûÈôÖÁöÑÂÉèÁ¥†ÁªòÂà∂Âà∞È°µÈù¢‰∏ä

## Ë¢´Âä®ÁöÑÊ∏≤Êüì

Âú®‰∏ãÈù¢ÁöÑËøô‰∏™‰æãÂ≠ê‰∏≠‰ΩøÁî®‰∫Ü‰∏Ä‰∏™ `video` Êù•Ë°®Á§∫È°µÈù¢ËøõË°åÂä®ÊÄÅÁöÑÊåÅÁª≠ÁöÑÈ°µÈù¢Ê∏≤Êüì, Ëøô‰∫õÂµåÂÖ•ÁöÑÂÜÖÂÆπÂèØ‰ª•Âú®‰∏çÂèó JavaScript ÁöÑÂπ≤Êâ∞‰∏ãÂΩ±ÂìçÈ°µÈù¢ÁöÑÊòæÁ§∫, ÂΩìÁÇπÂáªÊåâÈíÆÁöÑÊó∂ÂÄô JavaScript ËøõÂÖ•Ê≠ªÂæ™ÁéØ:

```javascript
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>test</title>
</head>
<body>
  <video src="https://vjs.zencdn.net/v/oceans.mp4" controls autoplay></video>
  <button id="button">while true</button>
  <script>
    document.getElementById('button').addEventListener('click',()=>{
      while(true);
    });
  </script>
</body>
</html>
```

ÂΩìÊàë‰ª¨ÁÇπÂáª‰∫ÜÊåâÈíÆÁöÑÊó∂ÂÄô:

1. click ‰∫ã‰ª∂Ë¢´ÊîæÂÖ•Âà∞‰∫Ü‰ªªÂä°ÈòüÂàó‰∏≠
2. ‰∫ã‰ª∂Âæ™ÁéØÂ∞Üclick ‰∫ã‰ª∂ÂéãÂÖ•Ë∞ÉÁî®Ê†à
3. `while true` ÊâßË°å

Ê≠§Êó∂Ê∏≤ÊüìÂ∑•‰ΩúÂú®Á≠âÂæÖ JavaScript ÊâßË°åÂÆåÊàê, ‰ΩÜÊòØ JavaScript ËøõÂÖ•‰∫ÜÊó†ÈôêÂæ™ÁéØ‰∏≠ÊâÄ‰ª•Ê∏≤ÊüìÂ∑•‰ΩúÂ∞±‰∏ÄÁõ¥Âú®Á≠âÂæÖ‰∏≠Ê∞∏Ëøú‰∏ç‰ºöÂæóÂà∞ÂÆåÊàê.

Ëß£ÈáäËøôÁßçË°å‰∏∫ÁöÑ‰∏Ä‰∏™Â•ΩÁöÑÊñπÂºèÂ∞±ÊòØ: **Êàë‰ª¨‰∏çÂ¶®ÊääÈ°µÈù¢ÁöÑÊ∏≤ÊüìËøáÁ®ã‰πüËßÜ‰∏∫ "‰ªªÂä°ÈòüÂàó" ‰∏≠ÁöÑ‰∏Ä‰∏™‰ªªÂä°, Ëøô‰∏™‰ªªÂä°ÁöÑÂàõÂª∫ËÄÖÂ∞±ÊòØÊµèËßàÂô®Êú¨Ë∫´,ÂÆÉÂú®‰∏Ä‰∏™ÂêàÈÄÇÁöÑÊó∂Êú∫ÊääÊ∏≤Êüì‰ªªÂä°ÊîæÂÖ•Âà∞‰ªªÂä°ÈòüÂàó‰∏≠Á≠âÂæÖÊâßË°å, ‰ΩÜÊòØÁî±‰∫é‰ª£Á†ÅÈòªÂ°ûÂØºËá¥È°µÈù¢Êó†Ê≥ïÂèäÊó∂Êõ¥Êñ∞.**

// TODO ÊúâÂæÖËØÅÂÆû

‰ΩÜÊòØÂÆûÈôÖÁöÑÊÉÖÂÜµË¶ÅÊõ¥‰∏∫Â§çÊùÇ‰∏Ä‰∫õ "‰ªªÂä°ÈòüÂàó" ÂÆûÈôÖ‰∏äÊúâÂ§ö‰∏™, Ê∏≤ÊüìÊòØ‰∏Ä‰∏™Â§çÊùÇÁöÑËøáÁ®ãÂÆÉÊúâËá™Â∑±ÁöÑ‰ªªÂä°ÈòüÂàó, ‰ΩÜÊòØ‰ªªÂä°ÈòüÂàó‰∏≠ÁöÑ‰ªªÂä°ÊâßË°åÈ°∫Â∫è‰æùÁÑ∂ÊòØÈÄöËøá "‰∫ã‰ª∂Âæ™ÁéØ" Êù•ÂÜ≥ÂÆöÁöÑ, ÊâÄ‰ª•‰πãÂâçÊèêÂà∞ÁöÑÁêÜËß£ÊñπÂºèÂπ∂Ê≤°ÊúâÂ§™Â§ßÁöÑÈóÆÈ¢ò.

## ÊÄùËÄÉ

‰∏ãÂàó‰ª£Á†Å‰ºöÈÄ†ÊàêÈòªÂ°ûÂêó:

```javascript
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>test</title>
</head>
<body>
  <video src="https://vjs.zencdn.net/v/oceans.mp4" controls autoplay></video>
  <button id="button">while true</button>
  <script>
    function loop(){
      setTimeout(loop,0);
    }
    loop();
  </script>
</body>
</html>
```

ËøôÊÆµ‰ª£Á†Å‰∏ç‰ªÖ‰∏ç‰ºöÈÄ†ÊàêÈòªÂ°ûÁîöËá≥‰∏ç‰ºöÈÄ†ÊàêÊ†àÊ∫¢Âá∫, ÊØèÊ¨°Ë∞ÉÁî® `loop` ÂáΩÊï∞‰ºöÂêë "‰ªªÂä°ÈòüÂàó" Ê∑ªÂä†‰∏Ä‰∏™‰ªªÂä°ÁÑ∂Âêé `loop` Â∞±‰ºöË¢´ÂºπÂá∫Ë∞ÉÁî®Ê†à, Ê≠§Êó∂ÁöÑË∞ÉÁî®Ê†àÂ∞±Ë¢´Ê∏ÖÁ©∫‰∫Ü, ËÄåË¥üË¥£ÊéßÂà∂‰ªªÂä°ÈòüÂàóÁöÑ‰∫ã‰ª∂Âæ™ÁéØÂè™ÊúâÂú®Ë∞ÉÁî®Ê†à‰∏∫Á©∫ÁöÑÊó∂ÂÄôÊâçËÉΩÁªßÁª≠ÊâßË°å‰ªªÂä°, ‰πüÂ∞±ÊòØËØ¥Ë∞ÉÁî®Ê†àÊ∞∏Ëøú‰∏ç‰ºöÁ¥ØÂä†.

ÂÖ∂Ê¨°‰ªªÂä°ÁöÑÊâßË°åÂπ∂‰∏çÂΩ±Âêë‰ªªÂä°ÈòüÂàóÊ∑ªÂä†ÂÜÖÂÆπ, Âú®Ë∞ÉÁî® `setTimeout(loop,0)` Âêé "‰∫ã‰ª∂Âæ™ÁéØ" ÁªßÁª≠Â∑•‰ΩúÂ§ÑÁêÜÈÇ£‰∫õÂ∑≤ÁªèË¢´Â°´ÂÖ•Âà∞‰ªªÂä°ÈòüÂàó‰∏≠Âú®Ê≠§‰πãÂâçÁöÑÂ°´ÂÖ•ÁöÑÂÖ∂‰ªñ‰∫ã‰ª∂‰ª•ÂèäÈ°µÈù¢ÁöÑÊ∏≤Êüì, Áõ¥Âà∞ "‰ªªÂä°ÈòüÂàó" ‰∏≠ÂÜçÊ¨°ÊâßË°åÊúâÂÖ≥ `loop` ÁöÑ‰ªªÂä°.

## ÊµÅÁïÖÁöÑÊ∏≤Êüì

ËØïÊÉ≥‰∏Ä‰∏ã‰Ω†Âú®È°µÈù¢‰∏äÂà∂‰Ωú‰∫Ü‰∏Ä‰∏™Âä®ÁîªÊïàÊûú‰ΩøÁî®Â¶Ç‰∏ã‰ª£Á†Å:

```javascript
function animate(){
  // ‰øÆÊîπÊ†∑Âºè
}

setInterval(animate,1000/60);
```

‰Ω†Â∏åÊúõÂä®ÁîªÂèØ‰ª•ËææÂà∞ 60fps ÊâÄ‰ª•Âêë `setInterval` ‰º†ÂÖ•‰∫Ü `1000/60` ÊúüÂæÖÂÆÉÂèØ‰ª•ÊØèÁßíÊâßË°å 60 Ê¨°Âä®ÁîªÂáΩÊï∞.

‰ΩÜÊòØÁî±‰∫é `setInterval` Âπ∂‰∏çÁ≤æÁ°ÆÂú®‰∏ÄÂ∏ß‰∏≠ÂèØËÉΩÊâßË°å‰∫ÜÂ§öÊ≠§, ‰πüÂèØËÉΩ‰∏ÄÊ¨°‰πüÊ≤°ÊúâÊâßË°å, ÊàñËÄÖÊâßË°å‰∫Ü‰∏Ä‰∏™ËÄóÊó∂ÁöÑ‰ªªÂä°ÂØºËá¥ÊµèËßàÂô®Êó†Ê≥ïÂú®‰∏ÄÂ∏ß‰∏≠ËøõË°åÊ∏≤ÊüìÊìç‰Ωú.

Êàë‰ª¨Â∏åÊúõÊØè‰∏ÄÂ∏ß‰∏≠Ëá≥Â∞ëÊúâ‰∏ÄÊ¨°Ê∏≤ÊüìËøáÁ®ã, ‰ΩÜÊòØ‰ªªÂä°ÁöÑÊâßË°åÊòØÈöèÊú∫ÁöÑ‰ªªÂä°ÊâßË°å‰ºöÊâì‰π±ÂéüÊúâËßÑÂæãÁöÑÊ∏≤ÊüìËøáÁ®ã:

![1566277658471](C:\Users\zhao\Documents\library\article\assets\1566277658471.png)

ËÄåÊµèËßàÂô®Êú¨Ë∫´ÁöÑÊ∏≤ÊüìÂÆûÈôÖ‰∏äÊòØÈùûÂ∏∏Êô∫ËÉΩÂíåËäÇÁ∫¶ËÆ°ÁÆóÁöÑ, ‰æãÂ¶ÇÈ°µÈù¢Ê∏≤ÊüìÈ¢ëÁéáËá™Âä®ÂíåÂ±èÂπïÂà∑Êñ∞ÁéáË∞ÉÊï¥Âà∞‰∏ÄËá¥, ÂΩìÈ°µÈù¢ÈùôÊ≠¢ÊàñËÄÖ‰∏çÂèØËßÜÁöÑÊó∂ÂÄôÈ°µÈù¢‰ºöÂÅúÊ≠¢Ê∏≤Êüì, ËÄå‰ΩøÁî® `setInterval` Á≠âÂæàÈöæÂÆåÁæéÁöÑÂíåÈ°µÈù¢Ê∏≤ÊüìËøáÁ®ãÁõ∏ÁªìÂêà.

‰∏Ä‰∏™Ëß£ÂÜ≥ÈóÆÈ¢òÁöÑÂäûÊ≥ïÂ∞±ÊòØ‰ΩøÁî® `requestAnimationFrame`.

> **window.requestAnimationFrame()** ÂëäËØâÊµèËßàÂô®‚Äî‚Äî‰Ω†Â∏åÊúõÊâßË°å‰∏Ä‰∏™Âä®ÁîªÔºåÂπ∂‰∏îË¶ÅÊ±ÇÊµèËßàÂô®Âú®‰∏ãÊ¨°ÈáçÁªò‰πãÂâçË∞ÉÁî®ÊåáÂÆöÁöÑÂõûË∞ÉÂáΩÊï∞Êõ¥Êñ∞Âä®Áîª

‰ΩøÁî® `requestAnimationFrame` Êàë‰ª¨ÂèØ‰ª•‰ΩøÁî®ÊµèËßàÂô®ÁöÑÊ∏≤ÊüìÈÄªËæëÂ∞ÜÂéüÊú¨ÊùÇ‰π±ÁöÑÊ∏≤ÊüìËøáÁ®ãÂèòÂæóÊúâÂ∫èËµ∑Êù•, ËÆ©ÊµèËßàÂô®ÂÜ≥ÂÆö‰ΩïÊó∂ËøõË°åÊ∏≤Êüì, ÂØπ‰∫éÂä®ÁîªÊ∏≤ÊüìËøôÂÜçÂ•Ω‰∏çËøá‰∫Ü, Áé∞Âú®ÊúâÂÖ≥Âä®ÁîªÁöÑ‰ªªÂä°ÈÉΩË¢´ÊéíÂàóÂà∞‰∫ÜÊ∏≤Êüì‰ªªÂä°ÁöÑÂâçÈù¢:

![1566279040998](C:\Users\zhao\Documents\library\article\assets\1566279040998.png)

## ÂæÆ‰ªªÂä° (micro task)

ÂæÆ‰ªªÂä°ÊòØ‰∏Ä‰∏™Â§çÊùÇÁöÑÊ¶ÇÂøµÂæàÂ§ö‰∫∫‰∏çÁêÜËß£ÂÖ∂Ë°å‰∏∫, Êàë‰ª¨‰ªéÂæÆ‰ªªÂä°ÁöÑËÆæËÆ°ÁõÆÁöÑ‰∏äÊù•Ëß£ÈáäÂæÆ‰ªªÂä°ÁöÑÂ∑•‰ΩúÂéüÁêÜ.

Âæà‰πÖÂâçW3CÁªôÊµèËßàÂô®Âà∂ÂÆö‰∫Ü‰∏Ä‰∫õAPI, Ëøô‰∫õAPIÁî®‰∫éÁõëÂê¨DOMÁöÑÂèòÂåñ:

```javascript
element.addEventListener("DOMNodeInserted", function (ev) {
  // ...
}, false);
```

‰ΩÜÊòØËøô‰∏™APIÊúâÁùÄ‰∏•ÈáçÁöÑÊÄßËÉΩÈóÆÈ¢ò, Âè™Ë¶Å‰øÆÊîπÂÖÉÁ¥†ÁöÑÂ±ûÊÄßÂØπÂ∫îÁöÑ‰∫ã‰ª∂Â∞±‰ºöË¢´Ëß¶Âèë, ÂØπÂêå‰∏Ä‰∏™Â±ûÊÄß‰øÆÊîπ100Ê¨°Â∞±‰ºöËß¶Âèë100Ê¨°ÁöÑ‰∫ã‰ª∂, Âè¶Â§ñ‰∫ã‰ª∂ÂÖ∑ÊúâÂÜíÊ≥°ÁöÑÁâπÊÄßÂ≠êÂÖÉÁ¥†ÁöÑ‰øÆÊîπ‰πü‰ºöÂØºËá¥Áà∂ÂÖÉÁ¥†Ëß¶ÂèëËØ•‰∫ã‰ª∂:

```javascript
let i = 100;
while(i--){
  const span = document.createElement('span');
  element.appendChild(span); // Ëß¶Âèë‰∫ã‰ª∂‰∏ÄÊ¨°
  span.textContent = 'Test'; // ÂÜçÊ¨°Ëß¶Âèë‰∫ã‰ª∂‰∏ÄÊ¨°
}
```

ÁªìÊûúÂ∞±ÊòØÊó†ËÆ∫‰Ω†Âú® `DOMNodeInserted` ÂõûË∞É‰∏≠ÂÜôÂ§ö‰πàÁÆÄÂçïÁöÑ‰ª£Á†Å, Â§çÊùÇÁöÑDOMÊìç‰ΩúÂØºËá¥‰∫ã‰ª∂Â∞±‰ºöË¢´ÂØÜÈõÜË∞ÉÁî®Â§ßÂ§ßÈôç‰ΩéÊÄßËÉΩ, ÊâÄ‰ª•Ëøô‰∏™APIË¢´Â∫üÂºÉ‰∫Ü.

ÁõëÂê¨DOM‰øÆÊîπÁöÑÈúÄÊ±Ç‰æùÁÑ∂Â≠òÂú®, ‰ΩÜÊòØÊàë‰ª¨Â∏åÊúõËøô‰∏™Êé•Âè£ÁöÑË°®Áé∞Â∞±ÂíåÊ∏≤Êüì‰∏ÄÊ†∑Â∞ÜDOM‰øÆÊîπËøõË°åÂêàÂπ∂ÂêéÂè™Ëß¶Âèë‰∏ÄÊ¨°, Ëøô‰∏™ËßÑËåÉÂú®DOM3‰∏≠Ë¢´Êé®Âá∫‰ªñÂ∞±ÊòØ [`MutationObserver`](https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver), ‰ªéËÄåÂºïÂÖ•‰∫Ü "ÂæÆ‰ªªÂä°" Âíå "ÂæÆ‰ªªÂä°ÈòüÂàó" Ëøô‰∏™Ê¶ÇÂøµ.

ÂæÆ‰ªªÂä°ÊòØÂºÇÊ≠•ÁöÑÊàë‰ª¨Áî®‰∏™ `Promise` Êù•‰∏æ‰æã:

```javascript
Promise.resolve().then(()=>console.log('hello world'));
console.log('foobar');
```

ËæìÂá∫:

```
foobar
hello world
```

`foobar` ÂÖà‰∫é `hello world` ËæìÂá∫ËøôÁÇπËØÅÊòé‰∫ÜÂÆÉ. ËôΩÁÑ∂‰ªñÊòØÂºÇÊ≠•ÁöÑ‰ΩÜËøô‰∏ç‰ª£Ë°®‰ªñÂøÖÈ°ªÈÅµÂæ™ "‰∫ã‰ª∂Âæ™ÁéØ" Âíå "Ê∏≤Êüì" Âà∂ÂÆöÁöÑËßÑÂàô. Áõ∏Âèç "ÂæÆ‰ªªÂä°" ÊúâËá™Â∑±ÁöÑÁé©Ê≥ï.

‰∏Ä‰∏™ÂÖ∏ÂûãÁöÑÁâπÂæÅÂ∞±ÊòØ**Âè™ÊúâÂæÆ‰ªªÂä°ÈòüÂàóÊ∏ÖÁ©∫ÂêéÂæÆ‰ªªÂä°ÊâçÁÆóÊâßË°åÂÆåÊàê**, Êàë‰ª¨Êää‰πãÂâçÁöÑ "‰∫ã‰ª∂Âæ™ÁéØ" ‰æãÂ≠êÊîπ‰∏∫ÂæÆ‰ªªÂä°ÁâàÊú¨:

```javascript
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>test</title>
</head>
<body>
  <video src="https://vjs.zencdn.net/v/oceans.mp4" controls autoplay></video>
  <button id="button">while true</button>
  <script>
    document.getElementById('button').addEventListener('click',()=>{
      function loop(){
          Promise.resolve().then(loop);
      }
      loop();
    });
  </script>
</body>
</html>
```

ÁªìÊûúÂ∞±ÊòØÂΩìÁÇπÂáªÊåâÈíÆÂêéÈ°µÈù¢Ê∏≤Êüì‰ºöÂÅúÊ≠¢ÊµèËßàÂô®ËøõÂÖ•Âà∞ÈòªÂ°û‰∏≠, ÂéüÂõ†ÂæàÁÆÄÂçï "ÂæÆ‰ªªÂä°ÈòüÂàó" ‰∏≠Ê∞∏ËøúÊúâ‰ªªÂä°ÊâÄ‰ª•ÊµèËßàÂô®‰∏ÄÁõ¥Âú®Á≠âÂæÖ "ÂæÆ‰ªªÂä°ÈòüÂàó" Ê∏ÖÁ©∫ÁÑ∂Âêé‰∏ÄÁõ¥ÊâßË°åÂæÆ‰ªªÂä°, ‰∏çÂπ∏ÁöÑÊòØËøôÊòØ‰∏Ä‰∏™Êó†Â∞ΩÁöÑ‰ªªÂä°ÈòüÂàóÊâÄ‰ª•ÂÆÉÊ∞∏ËøúÊó†Ê≥ïÊâßË°åÂÆå.

ÂæÆ‰ªªÂä°ÁöÑÂè¶Â§ñ‰∏Ä‰∏™ÁâπÊÄßÂ∞±ÊòØ **JavaScript Ë∞ÉÁî®Ê†à‰∏ÄÊó¶Ë¢´Ê∏ÖÁ©∫, ÂæÆ‰ªªÂä°ÈòüÂàó‰∏≠ÁöÑ‰ªªÂä°ÊâßË°å‰ºöÂÖà‰∫éÂÖ∂‰ªñÈòüÂàó**, ËØ∑ËßÇÂØü‰∏ãÈù¢ÁöÑ‰æãÂ≠ê:

```javascript

```



# Node.js ‰∏≠ÁöÑ‰∫ã‰ª∂Âæ™ÁéØ

node.js ÁöÑ‰∫ã‰ª∂Âæ™ÁéØÊ®°ÂûãÂíåÊµèËßàÂô®‰∏çÂêå, ‰∏çËøáÂú® node11 ÂêéËøõË°å‰∫ÜÁªü‰∏Ä, ËøôÈáåÊàë‰ª¨‰ºöÂàÜÂºÄËÆ®ËÆ∫.

## Node.js Â§öÁ∫øÁ®ãËøòÊòØÂ§öËøõÁ®ã?



# ÂºïÁî®

> https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/
>
> https://nodejs.org/dist/latest-v12.x/docs/api/worker_threads.html
>
> https://www.dynatrace.com/news/blog/all-you-need-to-know-to-really-understand-the-node-js-event-loop-and-its-metrics/#disqus_thread
>
> https://blog.csdn.net/Fundebug/article/details/86487117
>
> https://www.cnblogs.com/MuYunyun/p/7287413.html
>
> http://www.ruanyifeng.com/blog/2018/02/node-event-loop.html
>
> https://jsbin.com/dijodahawi/edit?html,css,js,console,output
>
> https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/
>
> https://segmentfault.com/a/1190000019759283



