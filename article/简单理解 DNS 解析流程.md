# DNS 解析流程

当你在浏览器地址栏中输入 `xxxx.com` 后, 如果你的浏览器和操作系统中没有发现对应的 ip 地址缓存, 那么会执行以下步骤:

1. 将域名发送到解析服务中(resolver server)

解析服务器基本上就是你的 ISP 网络服务提供商, 当解析服务器接收到查询请求后:

1. 检查本地缓存去检查域名对应的地址
   1. 如果没有找到则会发送请求到上一级也就是根解析服务器
   2. 如果找到了则返回对应的 ip 地址

顶级域名解析服务器或者说 DNS 服务中的根服务器:

- 有13个
- 被部署到了世界各地
- 被12个不同的组织机构运行
- 每个服务器都有自己唯一的 ip 地址

顶级域名解析服务器并不知道查询所对应的 ip 地址, 但是知道如何发送 解析器 去帮助查询找到对应的 id 地址.

根解析服务器会指导 解析器 前往 `.com` 的 TDL 或者顶级域名服务器.

所以 解析器 会向定义域名解析服务器发起查询, 在本例中会向掌管 `com` 的顶级域名服务器进行查询. 除此以外顶级域名服务器还有:

- net
- rog
- net
- ...

具体的 `.com` 顶级域服务器(TLD Top Level Server) 管理 `.com` 域名而 `xxxx.com` 便是其中的一部分.

但是顶级域名服务器(TLD)也不知道对应的 ip 地址, 会指挥 解析器 去下一级也是最后一级 "权威域名服务器"(Authoritative names servers).

再一次 解析器 会向 "权威域名服务器" 进行查询 `xxxx.com` 对应的 ip 地址. 而 "权威域名服务器" 会响应它知道的有关域名包含这个 ip 的任何内容.

此时 "权威域名服务器" 会响应 `xxxx.com` 对应的 ip 地址给 解析器, 解析器会返回查询的结果给你的计算机. 现在你的计算机可以拉取 `xxxx.com` 的数据了.

一旦 解析器 解析了一个陌生的域名, 他就会缓存这个域名所映射的内容, 以便在接收另外一个相同的解析的时候, 在去跑一遍完整流程.

# 在补充一点细节

1. DNS 使用 TCP 和 UDP 端口 53
2. 每一级域名长度不能超过 63 个字符, 域名总长度不能超过 253 个字符
3. 所有根域名服务器都是以同一份[根域文件](https://www.iana.org/domains/root/files)返回顶级域名权威服务器

# next

>  [DNS原理及解析过程详解](https://zhuanlan.zhihu.com/p/88260838)
>
> [DNS正向解析分为递归和迭代。 通常是用递归，还是迭代呢？](https://www.zhihu.com/question/53882349)