# 标题: 移动端布局基础概念指南

我没有移动端开发经验, 但是我对移动端的页面的布局很感兴趣, 在过去的几个月的时间里我浏览了一些有关移动端布局的文章.  
不过即使花了我十几个小时的阅读, 我依然是一头雾水.  
在一本比较旧的讲解响应式的书中我看到了这一句话:

> 这是因为 iOS 上的 Safari浏览器默认是在980像素宽的画布上渲染页面，然后将画布缩小到与视口大小匹配。 虽然得放大页面才能看清楚，但页面内容没有被切掉。

结合之前我浏览过的文章这些内容忽然被串联了起来, 这篇文章就是我对**响应式以及移动布局**基础的一些思考和总结.  
如果你想了解移动端布局的基本概念, 这篇文章将会非常适合你.  

# 移动端渲染表现

为了简单起见, 我们不从概念讲起, 我们先来看看一个固定宽度的元素被放置到移动端浏览器中会发生什么.

有如下代码:
```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <style>
    .example{
      width: 900px;
      background-color: aqua;
    }
  </style>
</head>
<body>
  <div class="example">
    我的宽度是 900px
  </div>
</body>
</html>
```

当然桌面浏览器渲染效果肯定在我们意料之中啦✨:

**图片**: 1920px下chrome渲染的效果:

![批注 2019-07-18 165112](./assets\移动端布局基础概念指南\批注 2019-07-18 165112.png)

而下面展示了图片展示了几个移动端浏览器渲染的结果:

**图片**: 移动端浏览器渲染效果:

![1563439703821](./assets\移动端布局基础概念指南\1563439703821.jpg)

这里我们简单的介绍一下图片中浏览器的版本, 这些浏览器在后文的截图中版本都是不会发生变化的.

| 浏览器  | 版本 | 平台      |
| ------- | ---- | --------- |
| chrome  | 75   | windows10 |
| chrome  | 75   | android9  |
| edge    | 42   | android9  |
| Samsung | 9.3  | android9  |

仔细观察我们发现:**900px 宽的 div 没有占满屏幕, 也就是说屏幕的宽度比 900px 还要大.**  
那么屏幕宽度到底是多大呢, 我们插入一行代码来获取HTML元素的宽度:

```html
<script>
  document.write(`html元素的宽度是${document.documentElement.clientWidth}`);
</script>
```

不同浏览器的显示结果为:

![1563441464510](./assets\移动端布局基础概念指南\1563441464510.jpg)

他们都输出了同样的数据那就是 980 在某种程度上我们知道了页面的宽度, 原来页面是 980px 的宽度所以 900px 的div无法铺满一行.  

对于移动浏览器它感知到自己的视口的宽度是 980px, 此时它渲染的比例就和一个 横向分辨率为 980px 的桌面显示器渲染的一样. 只不过移动终端的屏幕是一个小号的显示器而已.
在没有更改页面的设置的情况下或者说默认的情况下, 移动终端的浏览器会按照 980px 的宽度来渲染页面, 然后再将页面缩放到适合屏幕的大小.

不理解没关系, 我们使用一张图来理解这一行为:

![1563443177628](./assets\移动端布局基础概念指南\1563443177628.jpg)

为什么会有这种行为?

原因很简单, 在移动设备刚刚兴起的时候大多数的页面都是为桌面设计的在当时一个页面的内容区域的宽度一般在 980px 以内.

但是移动设备屏幕的分辨率很小, 例如某款手机的屏幕的横向分辨率是 320px 完全不足以容纳为桌面设计的页面.

和现在的情况相反, 手机厂商得设计一种方式来兼容现有的页面确保页面在移动端布局正常, 所以手机浏览器的默认内容区域的宽度被设置为桌面页面内容区域的典型值 980px(不同设备不同,后面有统一方法), 为了浏览效果和桌面一致将内容区域平铺到屏幕上. 

这样确保了布局正常且手机屏幕上浏览的整体效果和在桌面上的一致, 不过说到底移动端的横向分辨率只有 320px 自然有些内容看不清楚这个时候怎么办呢 -> 双击缩放呗🤣.

# 默认渲染方式导致的问题

回想一下移动端浏览器的两个默认的渲染行为:
1. 页面内容区域大小为 980px
2. 将页面区域按照比例缩放到屏幕的大小

对于响应式设计来说, 这种默认的行为有些问题. 例如第一种行为会导致媒体查询没无法使用, 因为移动端页面宽度固定 980px.

第二种自动缩放的行为会导致页面模糊(高分辨率的页面缩放到低分辨率的终端上), 或者难以辨别内容(高分辨率的终端导致文字太小).

在无额外的配置影响下, 下面的例子中的媒体查询不会起作用, 因为页面宽度为 980px 不会变化:

```html
<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <style>
    .example {
      width: 900px;
      background-color: aqua;
    }

    @media screen and (max-width:960px) {
      .example {
        background-color: red;
      }
    }
  </style>
</head>

<body>
  <div class="example">
    我的宽度是 900px
  </div>
  <script>
    document.write(`html元素的宽度是${document.documentElement.clientWidth}`);
  </script>
</body>

</html>
```

所以一个自然的想法就产生了**页面的大小应该和屏幕大小一致才对**啊, 这样我们就可以根据不同的屏幕尺寸来定制页面展示的效果.

## 初识 viewport 属性

需要借助于 `meta` 标签来完成, 通过设置 `<meta name="viewport" content="">` 来控制页面的渲染.

在大部分的IDE和文本编辑器中这行代码被放到了创建HTML文件的模板里, 所以很多人会觉得眼熟:

```html
<meta name="viewport" content="width=device-width, initial-scale=1.0">
```

这里你可以基本将这行代码理解为 "调整视口宽度和设备宽度一致", 更多的讨论我们在随后的中会提到.

**图片**:适应设备宽度后的渲染效果:

![1563458168665](./assets\移动端布局基础概念指南\1563458168665.jpg)

**注意**:上面图片中的三个浏览器实际上都是有横向滚动条的, 因为 900px 的 div 宽度超过了视口宽度.

页面中的内容显得更加大了一些, 除此以外看起来也没太大变化嘛. 不过这个手机看起来分辨率挺低的啊 html元素宽度居然是 412px , 这个年头的老人机的分辨率都比这个高了吧!

是的 HTML元素宽度确实是 412px , 但是我的手机屏幕的横向分辨率却是 1440px, 为什么?

看来我们又有了一个新的问题, 不过好在下一章中我们就可以解开这个谜团了.

# `css`像素与物理像素

`css` 中的 `px` 单位也就是我们常说的 "像素" 和显示器屏幕这个物理设备上提到的 "像素" 不是同一个东西, 换句话说 "`css` 中的像素" 不等于 "物理像素", 物理像素是屏幕上实际的像素点, 而 `css 像素` 是一个虚拟的单位.

这有点违反直觉, 因为在桌面浏览器上我们设置的一个 1px 大小的元素, 他所占的实际大小也是一个像素.

这因为大部分情况下桌面操作系统中设定的屏幕分辨率和显示器的物理分辨率都是一致的, 所以就会造成 "css 中的像素" 和 屏幕上的像素是同一个概念的误会.

不过证明 "`css` 中的像素" 不等于 "屏幕像素" 也不难, 例如在 `windows 10` 中你可以在 `显示设置->缩放与布局` 中设置系统缩放比例为 `125%`. 此时一个横向分辨率为 `1920` 的显示器去输出 html 元素的宽度的时候是 1536px. 

**图片**: 缩放选项:

![批注 2019-07-18 222819](./assets\移动端布局基础概念指南\批注 2019-07-18 222819.png)

**图片**:chrome和firefox的 HTML 元素的宽度:

![1563459939233](./assets\移动端布局基础概念指南\1563459939233.png)

另外你也可以简单的通过 `ctrl + 滚轮上/下` 来调整浏览器的缩放来模拟这种情况.  **不过你始终要记住这无非是使用了多个物理像素来显示一个 `css 像素` 而已.**

**注意**: 修改系统缩放比例会导致 `window.screen` 读取到的数据也是缩放后的而不是屏幕的原始分辨率.

##  `css`像素 在移动端

在早期的移动设备中常见的横向物理分辨率是 320px. 但是在现代的移动设备中的屏幕物理分辨率大部分都超过了 320px, 实际上现如今桌面显示器还在 1080p 的阶段, 移动设备的分辨率大部分都接近 2k 了, 所以这里会出现一个问题, **移动设备的屏幕太小如果一个`css`像素等于一个物理像素那么显示的东西会挤在一团导致无法浏览**. 所以终端厂商会在设备里面内置了一个 "最佳显示分辨率" 用于显示.

毫无疑问大部分的终端中这个 "最佳显示分辨率" 都小于设备的 "物理分辨率" , 因为它们**使用多个 "物理像素" 来显示一个 "css像素"**.

**例如:**我们有一个设备的横向物理像素数量是 1920, 某个终端制造商设置的内置的最佳显示值是 960, 那么我们就是用一个`css`像素来对应两个物理像素, 效果就是把显示的内容放大了一倍, 那么这个比值就是 1920 / 960 = 2 ,而这个值就是常说的**设备像素比**, 在浏览器中这个值我们可以使用 `windows.devicePixelRatio` 来获取.

我在 `windows 10` 系统缩放 125% 情况下和移动端中执行如下代码:

```html
<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    .example {
      width: 900px;
      background-color: aqua;
    }

  </style>
</head>

<body>
  <div class="example">
    我的宽度是 900px
  </div>
  <script>
    document.write(`html元素的宽度是${document.documentElement.clientWidth}px`);
    document.write(`<br>`); 
    document.write(`设备像素比是${window.devicePixelRatio}`);
    document.write(`<br>`); 
    document.write(`实际的物理分辨率是 ${screen.width} * ${window.devicePixelRatio} = ${screen.width * window.devicePixelRatio}px`);
  </script>
</body>

</html>
```

`windows 10` 输出结果如下:

![1570633377630](./assets\移动端布局基础概念指南\1570633377630.png)

移动端输出如下:

![1570634979264](./assets\移动端布局基础概念指南\1570634979264.jpg)

# 了解 viewport

viewport(视口) 的概念非常简单, 相当于浏览器整块渲染区域, 或者说它等于浏览器窗口, viewport 拥有它的宽高. 

在一个空白的页面中存在一个 div 这个 div 被设置了样式:

```css
div {
    width:30%;
    height:500px;
}
```

他的宽度被设定了一个相对值, 当窗口宽度发生改变的时候, 他会随着改变宽度. 那么这个百分比值相对的是谁呢? 根据规范是相对于父元素, `body` 的父元素是 `html` 而 `html` 的父元素就是 `viewport`.

## 移动端 viewport 模型

移动端的情况比较复杂一些, 这里有两个基本概念 `visual viewport` 和 `layout viewport`.

对于现在的页面来说理解这两个概念可能有点困难, 不过请请你试想以前你用手机浏览那些没有做移动端适配的页面所发生的情况.

这种情况就是, "页面上的内容非常小, 你需要通过双指放大才可以看清页面上的细节, 此时的页面往往会有横向滚动条".

这种行为就好像透过望远镜观察星空一样, 星空的大小是固定的, 但是我们可以透过望远镜选择观察局部的细节还是整体.

上面的例子中 "星空" 就是我们的页面, 而望远镜就是我们的手机屏幕, 星空代表的就是 `layout viewport` 而望远镜代表的就是 `visual viewport`.

星空有固定的大小, 那么 `layout viewport` 固定的大小是多少, 这个取决于浏览器, 不过现在常见的大小是 980px, 这个值你可以在本文稍早的移动端截图中找到.

`css` 设置的大小是作用在 `layout viewport` 的.

## 度量 `layout viewport`

`layout viewport` 可以通过 `document.body.clientWidth/Height` 来进行获取. 就像之前提到的一样 `layout viewport` 的值是固定的(默认情况下). 无论设备是竖屏还是横屏这个宽度都是 980px(默认情况下).

## 度量 `visual viewport`

`visual viewport` 可以通过 `window.innerWidth/Height` 来进行衡量. 这个属性会以 `css 像素` 作为单位返回值, 告诉你页面中还有多少空间可以用于布局, 很显然页面放大这个值会减少, 页面缩小这个值会变大.

**注意**: 这个值会将滚动条也包括在内.



# 使用 `<meta name="viewport">`

 `<meta name="viewport">` 属性在意义在于控制 `layout viewport` 的宽度(web 开发不在意高度).  你可以为其指定宽度借助于 `css 像素`, 也可以将其设置为自适应设备宽度, 下面的这个例子中我会尽可能的例举多个示例:

示例1, 设置为 500px:

```html
<meta name="viewport"  content="width=500px">
```

示例2, 等于屏幕的物理像素:

```html
<meta name="viewport"  content="width=device-width">
```

**注意**: 就像我之前在 [css 像素与物理像素](# `css`像素与物理像素) 这节提到的, 这个属性最终得到的值并不会是实际的物理像素, 而是由设备厂商提供的一个建议值.



# 移动端布局方案探讨

css像素会变化吗?

会变的只有设备的宽度

# 探讨缩放方案

> https://blog.csdn.net/rucwang/article/details/79050397
>
> https://www.cnblogs.com/yelongsan/p/7975580.html