# HTTPS 工作流程简单解释

# 为什么需要 SSL

## Encryption

隐藏从一台计算发送到另外一个计算机的东西.

## Identification

确保与你对话的计算机是可相信的.

# 简单流程

当你请求 `www.youtube.com` 后, DNS 解析服务会将域名解析为 ip 地址.

然后浏览器去访问这个 id 地址请求资源, 此时 `youtube.com` 会返回它的数字证书这个数字证书被签名机构签名, 当然该机构也会告诉浏览器, 为了简单起见证书中目前只包含:

- `youtube.com` 的公钥

数字签名机构也又证书而且是内置到操作系统中的, 所以浏览器可以访问到数字签名机构的公钥, 利用数字机构的公钥去解密被签名机构私钥加密的证书.

- 证书是被数字签名机构用私钥签名的, 所以解密签名证书失败则表示被签名证书是无效的.

被解密的证书中目前存在两个主要的内容:

- `youtube.com` 的公钥(之前提到的)
- 证书的指纹由数字签名机构写入

证书中还有很多其他的内容, 但是为了简化我们只提到了上述的两个, 其中很重要的一个内容就是证书的指纹, 指纹是数字签名机构通过对证书内容 hash + 私钥加密后的产物.

浏览器在解密了证书后还要 hash 证书内容然后与通过公钥解密的指纹进行比对, 这样做的目的是确保证书内容没有被篡改.

上述内容都完成后, 浏览器会生成一个随机的值, 这个值被 `youtube.com` 的公钥加密, 然后发送给 `youtube.com`.

当服务器接收到浏览器发送的内容后, 通过私钥解密, 此时浏览器和服务器都有了一个同样的随机值.

因为服务器和客户端都拥有了一个同样的值, 现在他们可以通过这个值来进行加密通信数据了.

# 数字签名机构

数字签名机构由一对公钥和私钥.

`youtube.com` 服务器也建立了一对公钥和私钥.

## 怎样签名证书

`youtube.com` 向数字签名机构发起了一个 "证书签名请求" 这个请求主要包含:

- `youtube.com` 公钥
- `youtube.com` 私钥

然后数字签名机构使用自己的私钥签名了这个 "证书签名请求", 这样一来任何拥有数字签名机构公钥的人都可以验证这个证书是由数字签名机构签名的.

**注意**: 操作系统和浏览器内置了许多证书由可信任的数字签名机构颁发

# next

> https://www.jianshu.com/p/072a8283c257
>
> https://segmentfault.com/a/1190000014835279?utm_source=tag-newest
>
> https://segmentfault.com/a/1190000015709520
>
> http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html