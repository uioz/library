# 标题 - 移动端布局原理

# 前言

在我的[上篇文章](https://segmentfault.com/a/1190000020672995#articleHeader2)中讨论了有关移动端布局基础概念, 其中包括了移动端是如何渲染页面, 以及 `<meta name="viewport">` 的使用方式.

本篇文章中我们会利用之前所学习到的内容来讨论移动端布局中存在的问题, 以及解决的方法, 以及现在流行的解决方案之间的差异与实现.

# 回顾

一个未经过任何设置的页面, 在移动端该页面的宽度为 980px(典型值).

由于页面的宽度固定, 但是移动设备的屏幕尺寸却多种多样, 大尺寸的屏幕无法利用高分辨率的优势显示更多的内容, 低分辨率的设备需要放大才可以看清页面上的内容.

所以移动端页面中都会控制页面视口的大小和设备一致:

```html
<meta name="viewport" content="width=device-width, initial-scale=1">
```

上述的代码会令浏览器去使用使用一个 "适应设备的分辨率" 去渲染, 一般来说往往越大的屏幕这个值越大, 那么不同的设备根据屏幕大小的部分也就会有相应的页面宽度了.

那么这个 "适应设备的分辨率" 的值是多少呢, 我们先得了解 "设备像素"(物理像素) 以及 "设备独立像素"(css 像素)之前的差别.

因为市面上的高分辨率的设备越来越多, 移动端页面的渲染, 不可能像PC页面那样 1个 `css像素` 就对应屏幕上的一个物理像素, 如果真的这样移动设备上的内容将会小到看不清.

所以终端制造商会让多个设备像素去显示一个设备独立像素, 例如让 4个物理像素 去渲染一个css像素, 那么 "设备像素比" `设备像素(物理像素) / 设备独立像素(css像素)` 也就是 4/1 = 4 就诞生了, 简写为 DPR.

你可以通过下列代码来获取它的大小:

```javascript
console.log(window.devicePixelRatio)
```

实际上 "适应设备的分辨率" 就是经过缩放后的最终大小, 例如一个手机屏幕的横向分辨率为 `1000px` DPR 为 2, 那么实际的页面宽度就是 `1000(设备像素) / 2(设备像素比) = 500px` .

# 主要问题

通过设置 `<meta content="viewport">` 我们在不同的设备上都可以获取到最棒的页面大小.

但是问题随之而来, 设计师给的设计图只有一张, 但是我们却需要兼容不同尺寸的屏幕, 处于成本考虑显然我们不可能为每一种分辨率都进行定制. 你还别急更为棘手的是设计师往往使用 `iphone6` 的 375px 作为设计稿的标准, 这个大小完全和实际页面不一致(典型页面宽度在 400px 左右).

所以关键的问题是要 **保证设计图上的内容可以完美且保持比例的在不同尺寸的设备上显示** . 那简单, 只要在所有需要指定尺寸的地方指定比例大小不指定固定宽度不就可以了吗, 很可惜**保持比例**思路是对的但是想要直接实现还是需要一些额外的过程.

接下来我们将继续深挖讨论问题的核心所在.

# 解决问题

## 基本思路

**按照比例缩放来适应不同页面大小是解决问题的核心所在**.

## 方案1: 页面适应设计稿

因为移动端的设计稿的标准宽度都是 750px, 如果我们让所有的设备的 `viewport` 的宽度和设计稿一致, 那么设计稿上的 1px 就是 页面上的 1px.

思路很简单而最简单的实现也非常容易:

// TODO: 待测试

// TODO: 添加示意图

```javascript
const scale = window.screen.width / 750;
document.write(`<meta name="viewport" content="initial-scale=${scale}">`)
```

`window.screen.width` 可以获取屏幕的物理宽度然后除以我们想要的宽度, 然后通过 `viewport` 设置缩放在写入到页面中就可以了.

**注意**: 如果设置了系统级别的缩放  `window.screen.width`拿到的宽度实际上也不是物理宽度.

但是这个问题有个致命的缺陷, 任何尺寸的指定都得假设页面在 750px 的宽度下. 如果你引入了第三方框架, 它们很可能无法正常工作. 另外在不同尺寸设备上实现固定文字大小也是非常困难的.

不过如果你的页面非常简单或者没有其他的条条框框束缚, 这绝对是最简单有效的手段之一.

## 方案2: rem 适应

rem 方案可谓是尽人皆知了, 流行的解决方案是淘宝的 `lib-flexable` 虽然经常被人吐槽有各种小问题, 不过在合适的场景下该用还是得用, 基本工作原理如下.

首先 rem 单位的大小就是 `<html>` 元素的 `font-size`, 例如:

```css
html {
    font-size:20px;
}

p{
    font-size:1rem; /* 等同于 20px */
}

div{
    font-size:.5rem; /* 等同于 10px */
}
```

现在我们将设计稿按照宽度分为 10 等分, 例如 750px / 10  = 75px, 为什么这么做呢? 因为在 750px 下 75px 就是 10% 的宽度, 如果我们将 `html` 的 `font-size` 设置为 `75px` 那么 `1rem` 就是 10% 的页面宽度, 如果页面中的一个元素 35px 宽, 我们只要给他指定 `.5rem` 就可以了.

为了在不同尺寸的页面令 `1rem` 等于 10% 的页面宽度, 我们有两种解决方式:

1. 根据页面大小来计算 `font-size` 使 `1rem` 等于 10% 的页面宽度
2. 把页面大小设置为 750px 然后给 `html` 设置 `font-size:75px`



我们通过插入 javascript 脚本来动态的计算 `html` 的 `font-size` 大小, 使之可以在声明 `1rem` 的时候等于 10% 的页面宽度.

简单的实现如下:

```

```

 

然后动态的修改 HTML 的 `font-size`, 



// TODO: 引用 MDN

```html
<meta name="viewport" content="initial-scale=scale,maximum-scale=scale,minimum-scale=scale,user-scalable=no">
<meta name="viewport" content="initial-scale=0.5,maximum-scale=0.5,minimum-scale=0.5,user-scalable=no">
<meta name="viewport" content="initial-scale=0.3333333333,maximum-scale=0.3333333333,minimum-scale=0.3333333333,user-scalable=no">
```



## 方案3: vm自适应

## 方案4: 固定尺寸单位与 flex 布局

## 方案5: 流式布局与响应式

## 方案4: 利用构建工具

## 总结

# 其他问题

## 图片

## 边框

# 参考

> https://www.w3cplus.com/mobile/lib-flexible-for-html5-layout.html